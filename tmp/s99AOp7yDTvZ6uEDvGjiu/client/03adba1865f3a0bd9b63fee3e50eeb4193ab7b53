__vite_ssr_exportName__("generateShoppingList", () => { try { return generateShoppingList } catch {} });
__vite_ssr_exportName__("formatEmailBody", () => { try { return formatEmailBody } catch {} });
__vite_ssr_exportName__("openEmailClient", () => { try { return openEmailClient } catch {} });
__vite_ssr_exportName__("shareMenu", () => { try { return shareMenu } catch {} });
function generateShoppingList(menu, allFoods) {
  const foodMap = /* @__PURE__ */ new Map();
  for (const food of allFoods) {
    foodMap.set(food.id, food);
  };
  const foodCounts = /* @__PURE__ */ new Map();
  const days = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
  for (const day of days) {
    const dayMeals = menu.meals[day];
    for (const mealType of ["breakfast", "lunch", "dinner"]) {
      const foodIds = dayMeals[mealType];
      for (const foodId of foodIds) {
        foodCounts.set(foodId, (foodCounts.get(foodId) || 0) + 1);
      }
    }
  };
  const grouped = {};
  for (const [foodId, count] of foodCounts) {
    const food = foodMap.get(foodId);
    if (!food) continue;
    const category = getPrimaryCategoryForGrouping(food);
    if (!grouped[category]) {
      grouped[category] = [];
    };
    grouped[category].push({
      name: food.name,
      count
    });
  };
  for (const category in grouped) {
    grouped[category].sort((a, b) => a.name.localeCompare(b.name));
  };
  return grouped;
};
function getPrimaryCategoryForGrouping(food) {
  const categoryPriority = [
    "rich-in-vegetables",
    "cruciferous",
    "greens",
    "rich-in-fruits",
    "berries",
    "rich-in-legumes",
    "rich-in-whole-grains",
    "nuts-and-seeds",
    "herbs-and-spices",
    "herbs-spices"
  ];
  for (const priority of categoryPriority) {
    if (food.categories.includes(priority)) {
      return formatCategoryName(priority);
    }
  };
  return food.categories.length > 0 ? formatCategoryName(food.categories[0]) : "Other";
}
function formatCategoryName(category) {
  const categoryNames = {
    "rich-in-vegetables": "VEGETABLES",
    "cruciferous": "VEGETABLES",
    "greens": "GREENS",
    "rich-in-fruits": "FRUITS",
    "berries": "FRUITS",
    "rich-in-legumes": "LEGUMES",
    "rich-in-whole-grains": "WHOLE GRAINS",
    "nuts-and-seeds": "NUTS & SEEDS",
    "herbs-and-spices": "HERBS & SPICES",
    "herbs-spices": "HERBS & SPICES"
  };
  return categoryNames[category] || category.toUpperCase().replace(/-/g, " ");
}
function formatEmailBody(menu, shoppingList) {
  let body = "";
  const weekDate = new Date(menu.weekOf);
  const weekStr = weekDate.toLocaleDateString("en-US", {
    month: "short",
    day: "numeric"
  });
  body += `=== SHOPPING LIST ===
`;
  body += `Week of ${weekStr}

`;
  const categories = Object.keys(shoppingList).sort();
  for (const category of categories) {
    body += `${category}:
`;
    for (const item of shoppingList[category]) {
      const countStr = item.count > 1 ? ` (${item.count}Ã—)` : "";
      body += `  - ${item.name}${countStr}
`;
    };
    body += "\n";
  };
  body += `
=== WEEKLY MENU PREVIEW ===

`;
  const days = [
    { key: "monday", label: "Monday" },
    { key: "tuesday", label: "Tuesday" },
    { key: "wednesday", label: "Wednesday" },
    { key: "thursday", label: "Thursday" },
    { key: "friday", label: "Friday" },
    { key: "saturday", label: "Saturday" },
    { key: "sunday", label: "Sunday" }
  ];
  for (const { key, label } of days) {
    const dayMeals = menu.meals[key];
    body += `${label}:
`;
    if (dayMeals.breakfast.length > 0) {
      body += `  Breakfast: ${dayMeals.breakfast.length} items
`;
    };
    if (dayMeals.lunch.length > 0) {
      body += `  Lunch: ${dayMeals.lunch.length} items
`;
    };
    if (dayMeals.dinner.length > 0) {
      body += `  Dinner: ${dayMeals.dinner.length} items
`;
    };
    body += "\n";
  };
  return body;
};
function openEmailClient(menu, allFoods) {
  const shoppingList = generateShoppingList(menu, allFoods);
  const body = formatEmailBody(menu, shoppingList);
  const weekDate = new Date(menu.weekOf);
  const weekStr = weekDate.toLocaleDateString("en-US", {
    month: "short",
    day: "numeric"
  });
  const subject = `Weekly Menu Shopping List - Week of ${weekStr}`;
  const mailtoUrl = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  window.location.href = mailtoUrl;
  console.log("[EmailExport] Opened email client");
};
async function shareMenu(menu, allFoods) {
  const shoppingList = generateShoppingList(menu, allFoods);
  const body = formatEmailBody(menu, shoppingList);
  const weekDate = new Date(menu.weekOf);
  const weekStr = weekDate.toLocaleDateString("en-US", {
    month: "short",
    day: "numeric"
  });
  const title = `Weekly Menu Shopping List - Week of ${weekStr}`;
  if (navigator.share) {
    try {
      await navigator.share({
        title,
        text: body
      });
      console.log("[EmailExport] Shared via Web Share API");
      return;
    } catch (error) {
      console.log("[EmailExport] Web Share cancelled or failed:", error);
    }
  };
  openEmailClient(menu, allFoods);
}
//# sourceMappingSource=vite-generated
//# sourceMappingURL=data:application/json;base64,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ckMsUUFBTSxVQUFVLFNBQVMsbUJBQW1CLFNBQVM7QUFBQSxJQUNuRCxPQUFPO0FBQUEsSUFDUCxLQUFLO0FBQUEsRUFDUCxDQUFDO0FBRUQsUUFBTSxVQUFVLHVDQUF1QyxPQUFPO0FBRzlELFFBQU0sWUFBWSxtQkFBbUIsbUJBQW1CLE9BQU8sQ0FBQyxTQUFTLG1CQUFtQixJQUFJLENBQUM7QUFHakcsU0FBTyxTQUFTLE9BQU87QUFFdkIsVUFBUSxJQUFJLG1DQUFtQztBQUNqRDtBQU9BLGVBQXNCLFVBQ3BCLE1BQ0EsVUFDZTtBQUNmLFFBQU0sZUFBZSxxQkFBcUIsTUFBTSxRQUFRO0FBQ3hELFFBQU0sT0FBTyxnQkFBZ0IsTUFBTSxZQUFZO0FBRS9DLFFBQU0sV0FBVyxJQUFJLEtBQUssS0FBSyxNQUFNO0FBQ3JDLFFBQU0sVUFBVSxTQUFTLG1CQUFtQixTQUFTO0FBQUEsSUFDbkQsT0FBTztBQUFBLElBQ1AsS0FBSztBQUFBLEVBQ1AsQ0FBQztBQUVELFFBQU0sUUFBUSx1Q0FBdUMsT0FBTztBQUc1RCxNQUFJLFVBQVUsT0FBTztBQUNuQixRQUFJO0FBQ0YsWUFBTSxVQUFVLE1BQU07QUFBQSxRQUNwQjtBQUFBLFFBQ0EsTUFBTTtBQUFBLE1BQ1IsQ0FBQztBQUVELGNBQVEsSUFBSSx3Q0FBd0M7QUFDcEQ7QUFBQSxJQUNGLFNBQVMsT0FBTztBQUVkLGNBQVEsSUFBSSxnREFBZ0QsS0FBSztBQUFBLElBQ25FO0FBQUEsRUFDRjtBQUdBLGtCQUFnQixNQUFNLFFBQVE7QUFDaEMiLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VzIjpbImVtYWlsRXhwb3J0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRW1haWwgRXhwb3J0IC0gU2hvcHBpbmcgTGlzdCAmIE1lbnUgRW1haWxcbiAqXG4gKiBHZW5lcmF0ZXMgc2hvcHBpbmcgbGlzdHMgYW5kIG1haWx0bzogbGlua3MgZm9yIGVtYWlsaW5nIHdlZWtseSBtZW51cy5cbiAqL1xuXG5pbXBvcnQgdHlwZSB7IFdlZWtseU1lbnUgfSBmcm9tICcuL21lbnVTdG9yYWdlJztcbmltcG9ydCB0eXBlIHsgRm9vZCB9IGZyb20gJy4vbWVudVN5bmVyZ3lFbmdpbmUnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUeXBlc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIEdyb3VwZWRJbmdyZWRpZW50cyB7XG4gIFtjYXRlZ29yeTogc3RyaW5nXTogQXJyYXk8e1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBjb3VudDogbnVtYmVyO1xuICB9Pjtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gU2hvcHBpbmcgTGlzdCBHZW5lcmF0aW9uXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogR2VuZXJhdGUgc2hvcHBpbmcgbGlzdCBmcm9tIHdlZWtseSBtZW51XG4gKlxuICogR3JvdXBzIGZvb2RzIGJ5IGNhdGVnb3J5IGFuZCBjb3VudHMgb2NjdXJyZW5jZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU2hvcHBpbmdMaXN0KFxuICBtZW51OiBXZWVrbHlNZW51LFxuICBhbGxGb29kczogRm9vZFtdXG4pOiBHcm91cGVkSW5ncmVkaWVudHMge1xuICAvLyBDcmVhdGUgZm9vZCBsb29rdXAgbWFwXG4gIGNvbnN0IGZvb2RNYXAgPSBuZXcgTWFwPHN0cmluZywgRm9vZD4oKTtcbiAgZm9yIChjb25zdCBmb29kIG9mIGFsbEZvb2RzKSB7XG4gICAgZm9vZE1hcC5zZXQoZm9vZC5pZCwgZm9vZCk7XG4gIH1cblxuICAvLyBDb3VudCBmb29kIG9jY3VycmVuY2VzXG4gIGNvbnN0IGZvb2RDb3VudHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuXG4gIC8vIEl0ZXJhdGUgdGhyb3VnaCBhbGwgZGF5cyBhbmQgbWVhbHNcbiAgY29uc3QgZGF5cyA9IFsnbW9uZGF5JywgJ3R1ZXNkYXknLCAnd2VkbmVzZGF5JywgJ3RodXJzZGF5JywgJ2ZyaWRheScsICdzYXR1cmRheScsICdzdW5kYXknXSBhcyBjb25zdDtcblxuICBmb3IgKGNvbnN0IGRheSBvZiBkYXlzKSB7XG4gICAgY29uc3QgZGF5TWVhbHMgPSBtZW51Lm1lYWxzW2RheV07XG5cbiAgICBmb3IgKGNvbnN0IG1lYWxUeXBlIG9mIFsnYnJlYWtmYXN0JywgJ2x1bmNoJywgJ2Rpbm5lciddIGFzIGNvbnN0KSB7XG4gICAgICBjb25zdCBmb29kSWRzID0gZGF5TWVhbHNbbWVhbFR5cGVdO1xuXG4gICAgICBmb3IgKGNvbnN0IGZvb2RJZCBvZiBmb29kSWRzKSB7XG4gICAgICAgIGZvb2RDb3VudHMuc2V0KGZvb2RJZCwgKGZvb2RDb3VudHMuZ2V0KGZvb2RJZCkgfHwgMCkgKyAxKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBHcm91cCBieSBwcmltYXJ5IGNhdGVnb3J5XG4gIGNvbnN0IGdyb3VwZWQ6IEdyb3VwZWRJbmdyZWRpZW50cyA9IHt9O1xuXG4gIGZvciAoY29uc3QgW2Zvb2RJZCwgY291bnRdIG9mIGZvb2RDb3VudHMpIHtcbiAgICBjb25zdCBmb29kID0gZm9vZE1hcC5nZXQoZm9vZElkKTtcbiAgICBpZiAoIWZvb2QpIGNvbnRpbnVlO1xuXG4gICAgLy8gRGV0ZXJtaW5lIHByaW1hcnkgY2F0ZWdvcnkgZm9yIGdyb3VwaW5nXG4gICAgY29uc3QgY2F0ZWdvcnkgPSBnZXRQcmltYXJ5Q2F0ZWdvcnlGb3JHcm91cGluZyhmb29kKTtcblxuICAgIGlmICghZ3JvdXBlZFtjYXRlZ29yeV0pIHtcbiAgICAgIGdyb3VwZWRbY2F0ZWdvcnldID0gW107XG4gICAgfVxuXG4gICAgZ3JvdXBlZFtjYXRlZ29yeV0ucHVzaCh7XG4gICAgICBuYW1lOiBmb29kLm5hbWUsXG4gICAgICBjb3VudCxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFNvcnQgaXRlbXMgd2l0aGluIGVhY2ggY2F0ZWdvcnkgYWxwaGFiZXRpY2FsbHlcbiAgZm9yIChjb25zdCBjYXRlZ29yeSBpbiBncm91cGVkKSB7XG4gICAgZ3JvdXBlZFtjYXRlZ29yeV0uc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7XG4gIH1cblxuICByZXR1cm4gZ3JvdXBlZDtcbn1cblxuLyoqXG4gKiBHZXQgcHJpbWFyeSBjYXRlZ29yeSBmb3IgZ3JvdXBpbmcgaW4gc2hvcHBpbmcgbGlzdFxuICovXG5mdW5jdGlvbiBnZXRQcmltYXJ5Q2F0ZWdvcnlGb3JHcm91cGluZyhmb29kOiBGb29kKTogc3RyaW5nIHtcbiAgLy8gUHJpb3JpdHkgb3JkZXIgZm9yIGNhdGVnb3J5IGdyb3VwaW5nXG4gIGNvbnN0IGNhdGVnb3J5UHJpb3JpdHkgPSBbXG4gICAgJ3JpY2gtaW4tdmVnZXRhYmxlcycsXG4gICAgJ2NydWNpZmVyb3VzJyxcbiAgICAnZ3JlZW5zJyxcbiAgICAncmljaC1pbi1mcnVpdHMnLFxuICAgICdiZXJyaWVzJyxcbiAgICAncmljaC1pbi1sZWd1bWVzJyxcbiAgICAncmljaC1pbi13aG9sZS1ncmFpbnMnLFxuICAgICdudXRzLWFuZC1zZWVkcycsXG4gICAgJ2hlcmJzLWFuZC1zcGljZXMnLFxuICAgICdoZXJicy1zcGljZXMnLFxuICBdO1xuXG4gIGZvciAoY29uc3QgcHJpb3JpdHkgb2YgY2F0ZWdvcnlQcmlvcml0eSkge1xuICAgIGlmIChmb29kLmNhdGVnb3JpZXMuaW5jbHVkZXMocHJpb3JpdHkpKSB7XG4gICAgICByZXR1cm4gZm9ybWF0Q2F0ZWdvcnlOYW1lKHByaW9yaXR5KTtcbiAgICB9XG4gIH1cblxuICAvLyBEZWZhdWx0IHRvIGZpcnN0IGNhdGVnb3J5XG4gIHJldHVybiBmb29kLmNhdGVnb3JpZXMubGVuZ3RoID4gMFxuICAgID8gZm9ybWF0Q2F0ZWdvcnlOYW1lKGZvb2QuY2F0ZWdvcmllc1swXSlcbiAgICA6ICdPdGhlcic7XG59XG5cbi8qKlxuICogRm9ybWF0IGNhdGVnb3J5IG5hbWUgZm9yIGRpc3BsYXlcbiAqL1xuZnVuY3Rpb24gZm9ybWF0Q2F0ZWdvcnlOYW1lKGNhdGVnb3J5OiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBjYXRlZ29yeU5hbWVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICdyaWNoLWluLXZlZ2V0YWJsZXMnOiAnVkVHRVRBQkxFUycsXG4gICAgJ2NydWNpZmVyb3VzJzogJ1ZFR0VUQUJMRVMnLFxuICAgICdncmVlbnMnOiAnR1JFRU5TJyxcbiAgICAncmljaC1pbi1mcnVpdHMnOiAnRlJVSVRTJyxcbiAgICAnYmVycmllcyc6ICdGUlVJVFMnLFxuICAgICdyaWNoLWluLWxlZ3VtZXMnOiAnTEVHVU1FUycsXG4gICAgJ3JpY2gtaW4td2hvbGUtZ3JhaW5zJzogJ1dIT0xFIEdSQUlOUycsXG4gICAgJ251dHMtYW5kLXNlZWRzJzogJ05VVFMgJiBTRUVEUycsXG4gICAgJ2hlcmJzLWFuZC1zcGljZXMnOiAnSEVSQlMgJiBTUElDRVMnLFxuICAgICdoZXJicy1zcGljZXMnOiAnSEVSQlMgJiBTUElDRVMnLFxuICB9O1xuXG4gIHJldHVybiBjYXRlZ29yeU5hbWVzW2NhdGVnb3J5XSB8fCBjYXRlZ29yeS50b1VwcGVyQ2FzZSgpLnJlcGxhY2UoLy0vZywgJyAnKTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRW1haWwgRm9ybWF0dGluZ1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEZvcm1hdCBlbWFpbCBib2R5IHdpdGggc2hvcHBpbmcgbGlzdCBhbmQgbWVudSBwcmV2aWV3XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRFbWFpbEJvZHkoXG4gIG1lbnU6IFdlZWtseU1lbnUsXG4gIHNob3BwaW5nTGlzdDogR3JvdXBlZEluZ3JlZGllbnRzXG4pOiBzdHJpbmcge1xuICBsZXQgYm9keSA9ICcnO1xuXG4gIC8vIEhlYWRlclxuICBjb25zdCB3ZWVrRGF0ZSA9IG5ldyBEYXRlKG1lbnUud2Vla09mKTtcbiAgY29uc3Qgd2Vla1N0ciA9IHdlZWtEYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLCB7XG4gICAgbW9udGg6ICdzaG9ydCcsXG4gICAgZGF5OiAnbnVtZXJpYycsXG4gIH0pO1xuXG4gIGJvZHkgKz0gYD09PSBTSE9QUElORyBMSVNUID09PVxcbmA7XG4gIGJvZHkgKz0gYFdlZWsgb2YgJHt3ZWVrU3RyfVxcblxcbmA7XG5cbiAgLy8gU2hvcHBpbmcgbGlzdCBncm91cGVkIGJ5IGNhdGVnb3J5XG4gIGNvbnN0IGNhdGVnb3JpZXMgPSBPYmplY3Qua2V5cyhzaG9wcGluZ0xpc3QpLnNvcnQoKTtcblxuICBmb3IgKGNvbnN0IGNhdGVnb3J5IG9mIGNhdGVnb3JpZXMpIHtcbiAgICBib2R5ICs9IGAke2NhdGVnb3J5fTpcXG5gO1xuXG4gICAgZm9yIChjb25zdCBpdGVtIG9mIHNob3BwaW5nTGlzdFtjYXRlZ29yeV0pIHtcbiAgICAgIGNvbnN0IGNvdW50U3RyID0gaXRlbS5jb3VudCA+IDEgPyBgICgke2l0ZW0uY291bnR9w5cpYCA6ICcnO1xuICAgICAgYm9keSArPSBgICAtICR7aXRlbS5uYW1lfSR7Y291bnRTdHJ9XFxuYDtcbiAgICB9XG5cbiAgICBib2R5ICs9ICdcXG4nO1xuICB9XG5cbiAgLy8gTWVudSBwcmV2aWV3XG4gIGJvZHkgKz0gYFxcbj09PSBXRUVLTFkgTUVOVSBQUkVWSUVXID09PVxcblxcbmA7XG5cbiAgY29uc3QgZGF5cyA9IFtcbiAgICB7IGtleTogJ21vbmRheScsIGxhYmVsOiAnTW9uZGF5JyB9LFxuICAgIHsga2V5OiAndHVlc2RheScsIGxhYmVsOiAnVHVlc2RheScgfSxcbiAgICB7IGtleTogJ3dlZG5lc2RheScsIGxhYmVsOiAnV2VkbmVzZGF5JyB9LFxuICAgIHsga2V5OiAndGh1cnNkYXknLCBsYWJlbDogJ1RodXJzZGF5JyB9LFxuICAgIHsga2V5OiAnZnJpZGF5JywgbGFiZWw6ICdGcmlkYXknIH0sXG4gICAgeyBrZXk6ICdzYXR1cmRheScsIGxhYmVsOiAnU2F0dXJkYXknIH0sXG4gICAgeyBrZXk6ICdzdW5kYXknLCBsYWJlbDogJ1N1bmRheScgfSxcbiAgXSBhcyBjb25zdDtcblxuICBmb3IgKGNvbnN0IHsga2V5LCBsYWJlbCB9IG9mIGRheXMpIHtcbiAgICBjb25zdCBkYXlNZWFscyA9IG1lbnUubWVhbHNba2V5XTtcbiAgICBib2R5ICs9IGAke2xhYmVsfTpcXG5gO1xuXG4gICAgLy8gT25seSBzaG93IG1lYWxzIHRoYXQgaGF2ZSBmb29kc1xuICAgIGlmIChkYXlNZWFscy5icmVha2Zhc3QubGVuZ3RoID4gMCkge1xuICAgICAgYm9keSArPSBgICBCcmVha2Zhc3Q6ICR7ZGF5TWVhbHMuYnJlYWtmYXN0Lmxlbmd0aH0gaXRlbXNcXG5gO1xuICAgIH1cbiAgICBpZiAoZGF5TWVhbHMubHVuY2gubGVuZ3RoID4gMCkge1xuICAgICAgYm9keSArPSBgICBMdW5jaDogJHtkYXlNZWFscy5sdW5jaC5sZW5ndGh9IGl0ZW1zXFxuYDtcbiAgICB9XG4gICAgaWYgKGRheU1lYWxzLmRpbm5lci5sZW5ndGggPiAwKSB7XG4gICAgICBib2R5ICs9IGAgIERpbm5lcjogJHtkYXlNZWFscy5kaW5uZXIubGVuZ3RofSBpdGVtc1xcbmA7XG4gICAgfVxuXG4gICAgYm9keSArPSAnXFxuJztcbiAgfVxuXG4gIHJldHVybiBib2R5O1xufVxuXG4vKipcbiAqIE9wZW4gZW1haWwgY2xpZW50IHdpdGggcHJlLWZpbGxlZCBjb250ZW50XG4gKlxuICogVXNlcyBtYWlsdG86IHByb3RvY29sIHRvIG9wZW4gZGVmYXVsdCBlbWFpbCBjbGllbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG9wZW5FbWFpbENsaWVudChcbiAgbWVudTogV2Vla2x5TWVudSxcbiAgYWxsRm9vZHM6IEZvb2RbXVxuKTogdm9pZCB7XG4gIGNvbnN0IHNob3BwaW5nTGlzdCA9IGdlbmVyYXRlU2hvcHBpbmdMaXN0KG1lbnUsIGFsbEZvb2RzKTtcbiAgY29uc3QgYm9keSA9IGZvcm1hdEVtYWlsQm9keShtZW51LCBzaG9wcGluZ0xpc3QpO1xuXG4gIGNvbnN0IHdlZWtEYXRlID0gbmV3IERhdGUobWVudS53ZWVrT2YpO1xuICBjb25zdCB3ZWVrU3RyID0gd2Vla0RhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1VUycsIHtcbiAgICBtb250aDogJ3Nob3J0JyxcbiAgICBkYXk6ICdudW1lcmljJyxcbiAgfSk7XG5cbiAgY29uc3Qgc3ViamVjdCA9IGBXZWVrbHkgTWVudSBTaG9wcGluZyBMaXN0IC0gV2VlayBvZiAke3dlZWtTdHJ9YDtcblxuICAvLyBDcmVhdGUgbWFpbHRvOiBVUkxcbiAgY29uc3QgbWFpbHRvVXJsID0gYG1haWx0bzo/c3ViamVjdD0ke2VuY29kZVVSSUNvbXBvbmVudChzdWJqZWN0KX0mYm9keT0ke2VuY29kZVVSSUNvbXBvbmVudChib2R5KX1gO1xuXG4gIC8vIE9wZW4gZW1haWwgY2xpZW50XG4gIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFpbHRvVXJsO1xuXG4gIGNvbnNvbGUubG9nKCdbRW1haWxFeHBvcnRdIE9wZW5lZCBlbWFpbCBjbGllbnQnKTtcbn1cblxuLyoqXG4gKiBVc2UgV2ViIFNoYXJlIEFQSSBpZiBhdmFpbGFibGUgKG1vYmlsZS1mcmllbmRseSlcbiAqXG4gKiBGYWxscyBiYWNrIHRvIG1haWx0bzogaWYgV2ViIFNoYXJlIEFQSSBpcyBub3Qgc3VwcG9ydGVkXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaGFyZU1lbnUoXG4gIG1lbnU6IFdlZWtseU1lbnUsXG4gIGFsbEZvb2RzOiBGb29kW11cbik6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzaG9wcGluZ0xpc3QgPSBnZW5lcmF0ZVNob3BwaW5nTGlzdChtZW51LCBhbGxGb29kcyk7XG4gIGNvbnN0IGJvZHkgPSBmb3JtYXRFbWFpbEJvZHkobWVudSwgc2hvcHBpbmdMaXN0KTtcblxuICBjb25zdCB3ZWVrRGF0ZSA9IG5ldyBEYXRlKG1lbnUud2Vla09mKTtcbiAgY29uc3Qgd2Vla1N0ciA9IHdlZWtEYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLCB7XG4gICAgbW9udGg6ICdzaG9ydCcsXG4gICAgZGF5OiAnbnVtZXJpYycsXG4gIH0pO1xuXG4gIGNvbnN0IHRpdGxlID0gYFdlZWtseSBNZW51IFNob3BwaW5nIExpc3QgLSBXZWVrIG9mICR7d2Vla1N0cn1gO1xuXG4gIC8vIFRyeSBXZWIgU2hhcmUgQVBJIGZpcnN0IChiZXR0ZXIgZm9yIG1vYmlsZSlcbiAgaWYgKG5hdmlnYXRvci5zaGFyZSkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBuYXZpZ2F0b3Iuc2hhcmUoe1xuICAgICAgICB0aXRsZSxcbiAgICAgICAgdGV4dDogYm9keSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zb2xlLmxvZygnW0VtYWlsRXhwb3J0XSBTaGFyZWQgdmlhIFdlYiBTaGFyZSBBUEknKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gVXNlciBjYW5jZWxsZWQgb3IgZXJyb3Igb2NjdXJyZWRcbiAgICAgIGNvbnNvbGUubG9nKCdbRW1haWxFeHBvcnRdIFdlYiBTaGFyZSBjYW5jZWxsZWQgb3IgZmFpbGVkOicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvLyBGYWxsYmFjayB0byBtYWlsdG86XG4gIG9wZW5FbWFpbENsaWVudChtZW51LCBhbGxGb29kcyk7XG59XG4iXSwiZmlsZSI6Ii9zcmMvdXRpbHMvZW1haWxFeHBvcnQudHMifQ==
