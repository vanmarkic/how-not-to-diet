__vite_ssr_exportName__("loadFoodsBundle", () => { try { return loadFoodsBundle } catch {} });
__vite_ssr_exportName__("buildSynergyMap", () => { try { return buildSynergyMap } catch {} });
__vite_ssr_exportName__("getSynergyScore", () => { try { return getSynergyScore } catch {} });
__vite_ssr_exportName__("calculateSuggestions", () => { try { return calculateSuggestions } catch {} });
__vite_ssr_exportName__("isFoodAppropriateForMeal", () => { try { return isFoodAppropriateForMeal } catch {} });
__vite_ssr_exportName__("filterByMealTiming", () => { try { return filterByMealTiming } catch {} });
__vite_ssr_exportName__("getCategoryDisplay", () => { try { return getCategoryDisplay } catch {} });
__vite_ssr_exportName__("runExample", () => { try { return runExample } catch {} });
async function loadFoodsBundle() {
  try {
    const response = await fetch("/how-not-to-diet/foods-bundle.json");
    const data = await response.json();
    return data.foods || [];
  } catch (error) {
    console.error("Failed to load foods bundle:", error);
    return [];
  }
};
function buildSynergyMap(foods) {
  const map = /* @__PURE__ */ new Map();
  for (const food of foods) {
    const foodNameLower = food.name.toLowerCase();
    const synergies = /* @__PURE__ */ new Set();
    for (const synergy of food.synergies) {
      synergies.add(synergy.toLowerCase());
    };
    map.set(foodNameLower, synergies);
  };
  return map;
};
function getSynergyScore(foodA, foodB, synergyMap) {
  const nameA = foodA.name.toLowerCase();
  const nameB = foodB.name.toLowerCase();
  const synergiesA = synergyMap.get(nameA) || /* @__PURE__ */ new Set();
  const synergiesB = synergyMap.get(nameB) || /* @__PURE__ */ new Set();
  if (synergiesA.has(nameB)) {
    return 10;
  };
  if (synergiesB.has(nameA)) {
    return 10;
  };
  for (const synergy of synergiesA) {
    if (nameB.includes(synergy) || synergy.includes(nameB)) {
      return 8;
    };
    if (foodB.categories.some((cat) => cat.includes(synergy) || synergy.includes(cat))) {
      return 6;
    }
  };
  for (const synergy of synergiesB) {
    if (nameA.includes(synergy) || synergy.includes(nameA)) {
      return 8;
    };
    if (foodA.categories.some((cat) => cat.includes(synergy) || synergy.includes(cat))) {
      return 6;
    }
  };
  return 0;
};
function calculateSuggestions(selectedFoodIds, mealType, allFoods, synergyMap) {
  if (selectedFoodIds.length === 0) {
    return filterByMealTiming(allFoods, mealType).map((food) => ({
      food,
      synergyScore: 0,
      category: "neutral",
      breakdown: []
    })).slice(0, 20);
  };
  const selectedFoodIdSet = new Set(selectedFoodIds);
  const selectedFoods = allFoods.filter((f) => selectedFoodIdSet.has(f.id));
  const candidates = allFoods.filter((food) => {
    if (selectedFoodIdSet.has(food.id)) {
      return false;
    };
    if (!isFoodAppropriateForMeal(food, mealType)) {
      return false;
    };
    return true;
  });
  const scoredCandidates = candidates.map((candidate) => {
    let totalScore = 0;
    const breakdown = [];
    for (const selectedFood of selectedFoods) {
      const score = getSynergyScore(candidate, selectedFood, synergyMap);
      totalScore += score;
      if (score > 0) {
        breakdown.push({
          withFood: selectedFood.name,
          score
        });
      }
    };
    return {
      food: candidate,
      synergyScore: totalScore,
      category: "neutral",
      // Will categorize in next step
      breakdown
    };
  });
  const rankedSuggestions = scoredCandidates.sort((a, b) => b.synergyScore - a.synergyScore).map((suggestion, index) => {
    let category = "neutral";
    if (index < 3 && suggestion.synergyScore >= 8) {
      category = "excellent";
    } else if (index < 8 && suggestion.synergyScore >= 3) {
      category = "good";
    };
    return {
      ...suggestion,
      category
    };
  });
  return rankedSuggestions;
};
function isFoodAppropriateForMeal(food, mealType) {
  if (food.timing.includes("any-meal")) {
    return true;
  };
  return food.timing.includes(mealType);
};
function filterByMealTiming(foods, mealType) {
  return foods.filter((food) => isFoodAppropriateForMeal(food, mealType));
};
function getCategoryDisplay(category) {
  switch (category) {
    case "excellent":
      return {
        label: "Excellent pairing",
        emoji: "⭐",
        color: "green"
      };
    case "good":
      return {
        label: "Good pairing",
        emoji: "✓",
        color: "blue"
      };
    case "neutral":
      return {
        label: "",
        emoji: "",
        color: "gray"
      };
  }
};
async function runExample() {
  console.log("Loading foods bundle...");
  const foods = await loadFoodsBundle();
  console.log(`Loaded ${foods.length} foods`);
  const synergyMap = buildSynergyMap(foods);
  console.log(`Built synergy map with ${synergyMap.size} entries`);
  const oats = foods.find((f) => f.name.toLowerCase().includes("oat"));
  if (!oats) {
    console.log("Oats not found");
    return;
  };
  console.log(`
Selected food: ${oats.name}`);
  console.log(`Synergies: ${oats.synergies.join(", ")}`);
  const suggestions = calculateSuggestions(
    [oats.id],
    "breakfast",
    foods,
    synergyMap
  );
  console.log(`
Top 10 suggestions for breakfast with ${oats.name}:`);
  suggestions.slice(0, 10).forEach((suggestion, index) => {
    const display = getCategoryDisplay(suggestion.category);
    console.log(
      `${index + 1}. ${display.emoji} ${suggestion.food.name} (Score: ${suggestion.synergyScore})`
    );
    if (suggestion.breakdown.length > 0) {
      suggestion.breakdown.forEach(({ withFood, score }) => {
        console.log(`     +${score} with ${withFood}`);
      });
    }
  });
}
//# sourceMappingSource=vite-generated
//# sourceMappingURL=data:application/json;base64,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SyxTQUFTLFFBQVEsRUFBRTtBQUFBLE1BQy9DLENBQUM7QUFBQSxJQUNIO0FBQUEsRUFDRixDQUFDO0FBQ0giLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VzIjpbIm1lbnVTeW5lcmd5RW5naW5lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTWVudSBCdWlsZGVyIFN5bmVyZ3kgRW5naW5lXG4gKlxuICogQ2FsY3VsYXRlcyBmb29kIHN1Z2dlc3Rpb25zIGJhc2VkIG9uIHN5bmVyZ2llcyB3aXRoaW4gYSBzaW5nbGUgbWVhbC5cbiAqIEltcGxlbWVudHMgdGhlIGRlc2lnbiBzcGVjaWZpZWQgaW4gZG9jcy9wbGFucy8yMDI1LTAxLTE5LW1lbnUtYnVpbGRlci1kZXNpZ24ubWRcbiAqL1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUeXBlc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIEZvb2Qge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIGNhdGVnb3JpZXM6IHN0cmluZ1tdO1xuICBwcm9wZXJ0aWVzOiBzdHJpbmdbXTtcbiAgYmVuZWZpdHM6IHN0cmluZyB8IHN0cmluZ1tdO1xuICBzeW5lcmdpZXM6IHN0cmluZ1tdO1xuICBjb25mbGljdHM/OiBzdHJpbmdbXTtcbiAgdGltaW5nOiBzdHJpbmdbXTtcbiAgYW1vdW50OiBzdHJpbmc7XG4gIHNvdXJjZXM6IHtcbiAgICBwYWdlczogbnVtYmVyW107XG4gICAgcXVvdGVzOiBzdHJpbmdbXTtcbiAgfTtcbn1cblxuZXhwb3J0IHR5cGUgTWVhbFR5cGUgPSAnYnJlYWtmYXN0JyB8ICdsdW5jaCcgfCAnZGlubmVyJztcblxuZXhwb3J0IHR5cGUgU3VnZ2VzdGlvbkNhdGVnb3J5ID0gJ2V4Y2VsbGVudCcgfCAnZ29vZCcgfCAnbmV1dHJhbCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3luZXJneUJyZWFrZG93biB7XG4gIHdpdGhGb29kOiBzdHJpbmc7XG4gIHNjb3JlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmFua2VkU3VnZ2VzdGlvbiB7XG4gIGZvb2Q6IEZvb2Q7XG4gIHN5bmVyZ3lTY29yZTogbnVtYmVyO1xuICBjYXRlZ29yeTogU3VnZ2VzdGlvbkNhdGVnb3J5O1xuICBicmVha2Rvd246IFN5bmVyZ3lCcmVha2Rvd25bXTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ29yZSBFbmdpbmUgRnVuY3Rpb25zXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogTG9hZCBhbGwgZm9vZHMgZnJvbSB0aGUgYWdncmVnYXRlZCBidW5kbGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRGb29kc0J1bmRsZSgpOiBQcm9taXNlPEZvb2RbXT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9ob3ctbm90LXRvLWRpZXQvZm9vZHMtYnVuZGxlLmpzb24nKTtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIHJldHVybiBkYXRhLmZvb2RzIHx8IFtdO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIGZvb2RzIGJ1bmRsZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbi8qKlxuICogQnVpbGQgYSBzeW5lcmd5IGxvb2t1cCBtYXAgZm9yIE8oMSkgYWNjZXNzXG4gKlxuICogTWFwIHN0cnVjdHVyZTogZm9vZE5hbWUgKGxvd2VyY2FzZSkgLT4gU2V0PGZvb2ROYW1lIChsb3dlcmNhc2UpPlxuICogVGhpcyBhbGxvd3MgZmFzdCBjaGVja2luZyBpZiBmb29kIEEgc3luZXJnaXplcyB3aXRoIGZvb2QgQlxuICovXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRTeW5lcmd5TWFwKGZvb2RzOiBGb29kW10pOiBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj4ge1xuICBjb25zdCBtYXAgPSBuZXcgTWFwPHN0cmluZywgU2V0PHN0cmluZz4+KCk7XG5cbiAgZm9yIChjb25zdCBmb29kIG9mIGZvb2RzKSB7XG4gICAgY29uc3QgZm9vZE5hbWVMb3dlciA9IGZvb2QubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IHN5bmVyZ2llcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuXG4gICAgLy8gQWRkIGFsbCBzeW5lcmdpZXMgKG5vcm1hbGl6ZWQgdG8gbG93ZXJjYXNlKVxuICAgIGZvciAoY29uc3Qgc3luZXJneSBvZiBmb29kLnN5bmVyZ2llcykge1xuICAgICAgc3luZXJnaWVzLmFkZChzeW5lcmd5LnRvTG93ZXJDYXNlKCkpO1xuICAgIH1cblxuICAgIG1hcC5zZXQoZm9vZE5hbWVMb3dlciwgc3luZXJnaWVzKTtcbiAgfVxuXG4gIHJldHVybiBtYXA7XG59XG5cbi8qKlxuICogR2V0IHN5bmVyZ3kgc2NvcmUgYmV0d2VlbiB0d28gZm9vZHNcbiAqXG4gKiBCaWRpcmVjdGlvbmFsIGNoZWNrOiBBIHN5bmVyZ2l6ZXMgd2l0aCBCIE9SIEIgc3luZXJnaXplcyB3aXRoIEFcbiAqIERlZmF1bHQgc2NvcmUgaXMgMTAgZm9yIGFuIGV4cGxpY2l0IHN5bmVyZ3kgbWF0Y2hcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFN5bmVyZ3lTY29yZShcbiAgZm9vZEE6IEZvb2QsXG4gIGZvb2RCOiBGb29kLFxuICBzeW5lcmd5TWFwOiBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj5cbik6IG51bWJlciB7XG4gIGNvbnN0IG5hbWVBID0gZm9vZEEubmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBuYW1lQiA9IGZvb2RCLm5hbWUudG9Mb3dlckNhc2UoKTtcblxuICBjb25zdCBzeW5lcmdpZXNBID0gc3luZXJneU1hcC5nZXQobmFtZUEpIHx8IG5ldyBTZXQoKTtcbiAgY29uc3Qgc3luZXJnaWVzQiA9IHN5bmVyZ3lNYXAuZ2V0KG5hbWVCKSB8fCBuZXcgU2V0KCk7XG5cbiAgLy8gQ2hlY2sgaWYgZm9vZEEgbGlzdHMgZm9vZEIgYXMgYSBzeW5lcmd5IChleGFjdCBtYXRjaClcbiAgaWYgKHN5bmVyZ2llc0EuaGFzKG5hbWVCKSkge1xuICAgIHJldHVybiAxMDtcbiAgfVxuXG4gIC8vIENoZWNrIGlmIGZvb2RCIGxpc3RzIGZvb2RBIGFzIGEgc3luZXJneSAoZXhhY3QgbWF0Y2gpXG4gIGlmIChzeW5lcmdpZXNCLmhhcyhuYW1lQSkpIHtcbiAgICByZXR1cm4gMTA7XG4gIH1cblxuICAvLyBDaGVjayBmb3IgcGFydGlhbCBtYXRjaGVzIGluIHN5bmVyZ2llcyAoZS5nLiwgXCJ2ZWdldGFibGVzXCIgbWF0Y2hlcyBcImJlYW4gc3Byb3V0c1wiKVxuICBmb3IgKGNvbnN0IHN5bmVyZ3kgb2Ygc3luZXJnaWVzQSkge1xuICAgIC8vIENoZWNrIGlmIHN5bmVyZ3kgc3RyaW5nIGNvbnRhaW5zIHRoZSBvdGhlciBmb29kJ3MgbmFtZVxuICAgIGlmIChuYW1lQi5pbmNsdWRlcyhzeW5lcmd5KSB8fCBzeW5lcmd5LmluY2x1ZGVzKG5hbWVCKSkge1xuICAgICAgcmV0dXJuIDg7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgY2F0ZWdvcnkgbWF0Y2hlcyAoZS5nLiwgXCJ2ZWdldGFibGVzXCIgc3luZXJneSArIGZvb2RCIGlzIGluIHZlZ2V0YWJsZXMgY2F0ZWdvcnkpXG4gICAgaWYgKGZvb2RCLmNhdGVnb3JpZXMuc29tZShjYXQgPT4gY2F0LmluY2x1ZGVzKHN5bmVyZ3kpIHx8IHN5bmVyZ3kuaW5jbHVkZXMoY2F0KSkpIHtcbiAgICAgIHJldHVybiA2O1xuICAgIH1cbiAgfVxuXG4gIGZvciAoY29uc3Qgc3luZXJneSBvZiBzeW5lcmdpZXNCKSB7XG4gICAgaWYgKG5hbWVBLmluY2x1ZGVzKHN5bmVyZ3kpIHx8IHN5bmVyZ3kuaW5jbHVkZXMobmFtZUEpKSB7XG4gICAgICByZXR1cm4gODtcbiAgICB9XG5cbiAgICBpZiAoZm9vZEEuY2F0ZWdvcmllcy5zb21lKGNhdCA9PiBjYXQuaW5jbHVkZXMoc3luZXJneSkgfHwgc3luZXJneS5pbmNsdWRlcyhjYXQpKSkge1xuICAgICAgcmV0dXJuIDY7XG4gICAgfVxuICB9XG5cbiAgLy8gTm8gc3luZXJneSBmb3VuZFxuICByZXR1cm4gMDtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgc3luZXJneSBzdWdnZXN0aW9ucyBmb3IgYSBtZWFsXG4gKlxuICogQHBhcmFtIHNlbGVjdGVkRm9vZElkcyAtIElEcyBvZiBmb29kcyBhbHJlYWR5IGluIHRoZSBtZWFsXG4gKiBAcGFyYW0gbWVhbFR5cGUgLSBicmVha2Zhc3QsIGx1bmNoLCBvciBkaW5uZXJcbiAqIEBwYXJhbSBhbGxGb29kcyAtIENvbXBsZXRlIGxpc3Qgb2YgYXZhaWxhYmxlIGZvb2RzXG4gKiBAcGFyYW0gc3luZXJneU1hcCAtIFByZS1idWlsdCBzeW5lcmd5IGxvb2t1cCBtYXBcbiAqIEByZXR1cm5zIFJhbmtlZCBzdWdnZXN0aW9ucyB3aXRoIHNjb3JlcyBhbmQgY2F0ZWdvcmllc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlU3VnZ2VzdGlvbnMoXG4gIHNlbGVjdGVkRm9vZElkczogc3RyaW5nW10sXG4gIG1lYWxUeXBlOiBNZWFsVHlwZSxcbiAgYWxsRm9vZHM6IEZvb2RbXSxcbiAgc3luZXJneU1hcDogTWFwPHN0cmluZywgU2V0PHN0cmluZz4+XG4pOiBSYW5rZWRTdWdnZXN0aW9uW10ge1xuICAvLyBIYW5kbGUgZWRnZSBjYXNlOiBubyBzZWxlY3RlZCBmb29kcyB5ZXRcbiAgaWYgKHNlbGVjdGVkRm9vZElkcy5sZW5ndGggPT09IDApIHtcbiAgICAvLyBSZXR1cm4gbWVhbC1hcHByb3ByaWF0ZSBmb29kcyB3aXRoIG5ldXRyYWwgY2F0ZWdvcnlcbiAgICByZXR1cm4gZmlsdGVyQnlNZWFsVGltaW5nKGFsbEZvb2RzLCBtZWFsVHlwZSlcbiAgICAgIC5tYXAoZm9vZCA9PiAoe1xuICAgICAgICBmb29kLFxuICAgICAgICBzeW5lcmd5U2NvcmU6IDAsXG4gICAgICAgIGNhdGVnb3J5OiAnbmV1dHJhbCcgYXMgU3VnZ2VzdGlvbkNhdGVnb3J5LFxuICAgICAgICBicmVha2Rvd246IFtdLFxuICAgICAgfSkpXG4gICAgICAuc2xpY2UoMCwgMjApOyAvLyBMaW1pdCBpbml0aWFsIHN1Z2dlc3Rpb25zXG4gIH1cblxuICAvLyBTdGVwIDE6IEZpbHRlciBjYW5kaWRhdGVzXG4gIGNvbnN0IHNlbGVjdGVkRm9vZElkU2V0ID0gbmV3IFNldChzZWxlY3RlZEZvb2RJZHMpO1xuICBjb25zdCBzZWxlY3RlZEZvb2RzID0gYWxsRm9vZHMuZmlsdGVyKGYgPT4gc2VsZWN0ZWRGb29kSWRTZXQuaGFzKGYuaWQpKTtcblxuICBjb25zdCBjYW5kaWRhdGVzID0gYWxsRm9vZHMuZmlsdGVyKGZvb2QgPT4ge1xuICAgIC8vIEV4Y2x1ZGUgYWxyZWFkeS1zZWxlY3RlZCBmb29kc1xuICAgIGlmIChzZWxlY3RlZEZvb2RJZFNldC5oYXMoZm9vZC5pZCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBtZWFsIHRpbWluZyBjb25zdHJhaW50XG4gICAgaWYgKCFpc0Zvb2RBcHByb3ByaWF0ZUZvck1lYWwoZm9vZCwgbWVhbFR5cGUpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH0pO1xuXG4gIC8vIFN0ZXAgMjogQ2FsY3VsYXRlIHN5bmVyZ3kgc2NvcmVzXG4gIGNvbnN0IHNjb3JlZENhbmRpZGF0ZXM6IFJhbmtlZFN1Z2dlc3Rpb25bXSA9IGNhbmRpZGF0ZXMubWFwKGNhbmRpZGF0ZSA9PiB7XG4gICAgbGV0IHRvdGFsU2NvcmUgPSAwO1xuICAgIGNvbnN0IGJyZWFrZG93bjogU3luZXJneUJyZWFrZG93bltdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHNlbGVjdGVkRm9vZCBvZiBzZWxlY3RlZEZvb2RzKSB7XG4gICAgICBjb25zdCBzY29yZSA9IGdldFN5bmVyZ3lTY29yZShjYW5kaWRhdGUsIHNlbGVjdGVkRm9vZCwgc3luZXJneU1hcCk7XG4gICAgICB0b3RhbFNjb3JlICs9IHNjb3JlO1xuXG4gICAgICBpZiAoc2NvcmUgPiAwKSB7XG4gICAgICAgIGJyZWFrZG93bi5wdXNoKHtcbiAgICAgICAgICB3aXRoRm9vZDogc2VsZWN0ZWRGb29kLm5hbWUsXG4gICAgICAgICAgc2NvcmUsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBmb29kOiBjYW5kaWRhdGUsXG4gICAgICBzeW5lcmd5U2NvcmU6IHRvdGFsU2NvcmUsXG4gICAgICBjYXRlZ29yeTogJ25ldXRyYWwnIGFzIFN1Z2dlc3Rpb25DYXRlZ29yeSwgLy8gV2lsbCBjYXRlZ29yaXplIGluIG5leHQgc3RlcFxuICAgICAgYnJlYWtkb3duLFxuICAgIH07XG4gIH0pO1xuXG4gIC8vIFN0ZXAgMzogUmFuayBhbmQgY2F0ZWdvcml6ZVxuICBjb25zdCByYW5rZWRTdWdnZXN0aW9ucyA9IHNjb3JlZENhbmRpZGF0ZXNcbiAgICAuc29ydCgoYSwgYikgPT4gYi5zeW5lcmd5U2NvcmUgLSBhLnN5bmVyZ3lTY29yZSlcbiAgICAubWFwKChzdWdnZXN0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgbGV0IGNhdGVnb3J5OiBTdWdnZXN0aW9uQ2F0ZWdvcnkgPSAnbmV1dHJhbCc7XG5cbiAgICAgIGlmIChpbmRleCA8IDMgJiYgc3VnZ2VzdGlvbi5zeW5lcmd5U2NvcmUgPj0gOCkge1xuICAgICAgICBjYXRlZ29yeSA9ICdleGNlbGxlbnQnO1xuICAgICAgfSBlbHNlIGlmIChpbmRleCA8IDggJiYgc3VnZ2VzdGlvbi5zeW5lcmd5U2NvcmUgPj0gMykge1xuICAgICAgICBjYXRlZ29yeSA9ICdnb29kJztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3VnZ2VzdGlvbixcbiAgICAgICAgY2F0ZWdvcnksXG4gICAgICB9O1xuICAgIH0pO1xuXG4gIHJldHVybiByYW5rZWRTdWdnZXN0aW9ucztcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSGVscGVyIEZ1bmN0aW9uc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIENoZWNrIGlmIGEgZm9vZCBpcyBhcHByb3ByaWF0ZSBmb3IgYSBzcGVjaWZpYyBtZWFsIHR5cGVcbiAqXG4gKiBGb29kcyB3aXRoICdhbnktbWVhbCcgdGltaW5nIGFyZSBhbHdheXMgYXBwcm9wcmlhdGVcbiAqIE90aGVyd2lzZSwgdGltaW5nIGFycmF5IG11c3QgaW5jbHVkZSB0aGUgc3BlY2lmaWMgbWVhbCB0eXBlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0Zvb2RBcHByb3ByaWF0ZUZvck1lYWwoZm9vZDogRm9vZCwgbWVhbFR5cGU6IE1lYWxUeXBlKTogYm9vbGVhbiB7XG4gIC8vICdhbnktbWVhbCcgaXMgYWx3YXlzIGFwcHJvcHJpYXRlXG4gIGlmIChmb29kLnRpbWluZy5pbmNsdWRlcygnYW55LW1lYWwnKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gQ2hlY2sgZm9yIGV4cGxpY2l0IG1lYWwgdHlwZVxuICByZXR1cm4gZm9vZC50aW1pbmcuaW5jbHVkZXMobWVhbFR5cGUpO1xufVxuXG4vKipcbiAqIEZpbHRlciBmb29kcyBieSBtZWFsIHRpbWluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyQnlNZWFsVGltaW5nKGZvb2RzOiBGb29kW10sIG1lYWxUeXBlOiBNZWFsVHlwZSk6IEZvb2RbXSB7XG4gIHJldHVybiBmb29kcy5maWx0ZXIoZm9vZCA9PiBpc0Zvb2RBcHByb3ByaWF0ZUZvck1lYWwoZm9vZCwgbWVhbFR5cGUpKTtcbn1cblxuLyoqXG4gKiBHZXQgY2F0ZWdvcnkgZGlzcGxheSBwcm9wZXJ0aWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDYXRlZ29yeURpc3BsYXkoY2F0ZWdvcnk6IFN1Z2dlc3Rpb25DYXRlZ29yeSk6IHtcbiAgbGFiZWw6IHN0cmluZztcbiAgZW1vamk6IHN0cmluZztcbiAgY29sb3I6IHN0cmluZztcbn0ge1xuICBzd2l0Y2ggKGNhdGVnb3J5KSB7XG4gICAgY2FzZSAnZXhjZWxsZW50JzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxhYmVsOiAnRXhjZWxsZW50IHBhaXJpbmcnLFxuICAgICAgICBlbW9qaTogJ+KtkCcsXG4gICAgICAgIGNvbG9yOiAnZ3JlZW4nLFxuICAgICAgfTtcbiAgICBjYXNlICdnb29kJzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxhYmVsOiAnR29vZCBwYWlyaW5nJyxcbiAgICAgICAgZW1vamk6ICfinJMnLFxuICAgICAgICBjb2xvcjogJ2JsdWUnLFxuICAgICAgfTtcbiAgICBjYXNlICduZXV0cmFsJzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxhYmVsOiAnJyxcbiAgICAgICAgZW1vamk6ICcnLFxuICAgICAgICBjb2xvcjogJ2dyYXknLFxuICAgICAgfTtcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBFeGFtcGxlIFVzYWdlIChmb3IgdGVzdGluZylcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJ1bkV4YW1wbGUoKSB7XG4gIGNvbnNvbGUubG9nKCdMb2FkaW5nIGZvb2RzIGJ1bmRsZS4uLicpO1xuICBjb25zdCBmb29kcyA9IGF3YWl0IGxvYWRGb29kc0J1bmRsZSgpO1xuICBjb25zb2xlLmxvZyhgTG9hZGVkICR7Zm9vZHMubGVuZ3RofSBmb29kc2ApO1xuXG4gIGNvbnN0IHN5bmVyZ3lNYXAgPSBidWlsZFN5bmVyZ3lNYXAoZm9vZHMpO1xuICBjb25zb2xlLmxvZyhgQnVpbHQgc3luZXJneSBtYXAgd2l0aCAke3N5bmVyZ3lNYXAuc2l6ZX0gZW50cmllc2ApO1xuXG4gIC8vIEV4YW1wbGU6IFVzZXIgc2VsZWN0cyBcIk9hdHNcIiBmb3IgYnJlYWtmYXN0XG4gIGNvbnN0IG9hdHMgPSBmb29kcy5maW5kKGYgPT4gZi5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ29hdCcpKTtcbiAgaWYgKCFvYXRzKSB7XG4gICAgY29uc29sZS5sb2coJ09hdHMgbm90IGZvdW5kJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc29sZS5sb2coYFxcblNlbGVjdGVkIGZvb2Q6ICR7b2F0cy5uYW1lfWApO1xuICBjb25zb2xlLmxvZyhgU3luZXJnaWVzOiAke29hdHMuc3luZXJnaWVzLmpvaW4oJywgJyl9YCk7XG5cbiAgY29uc3Qgc3VnZ2VzdGlvbnMgPSBjYWxjdWxhdGVTdWdnZXN0aW9ucyhcbiAgICBbb2F0cy5pZF0sXG4gICAgJ2JyZWFrZmFzdCcsXG4gICAgZm9vZHMsXG4gICAgc3luZXJneU1hcFxuICApO1xuXG4gIGNvbnNvbGUubG9nKGBcXG5Ub3AgMTAgc3VnZ2VzdGlvbnMgZm9yIGJyZWFrZmFzdCB3aXRoICR7b2F0cy5uYW1lfTpgKTtcbiAgc3VnZ2VzdGlvbnMuc2xpY2UoMCwgMTApLmZvckVhY2goKHN1Z2dlc3Rpb24sIGluZGV4KSA9PiB7XG4gICAgY29uc3QgZGlzcGxheSA9IGdldENhdGVnb3J5RGlzcGxheShzdWdnZXN0aW9uLmNhdGVnb3J5KTtcbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGAke2luZGV4ICsgMX0uICR7ZGlzcGxheS5lbW9qaX0gJHtzdWdnZXN0aW9uLmZvb2QubmFtZX0gKFNjb3JlOiAke3N1Z2dlc3Rpb24uc3luZXJneVNjb3JlfSlgXG4gICAgKTtcblxuICAgIGlmIChzdWdnZXN0aW9uLmJyZWFrZG93bi5sZW5ndGggPiAwKSB7XG4gICAgICBzdWdnZXN0aW9uLmJyZWFrZG93bi5mb3JFYWNoKCh7IHdpdGhGb29kLCBzY29yZSB9KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgICske3Njb3JlfSB3aXRoICR7d2l0aEZvb2R9YCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufVxuIl0sImZpbGUiOiIvc3JjL3V0aWxzL21lbnVTeW5lcmd5RW5naW5lLnRzIn0=
