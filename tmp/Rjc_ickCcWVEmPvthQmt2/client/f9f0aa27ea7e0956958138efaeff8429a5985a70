__vite_ssr_exportName__("createEmptyMenu", () => { try { return createEmptyMenu } catch {} });
__vite_ssr_exportName__("autoSaveMenu", () => { try { return autoSaveMenu } catch {} });
__vite_ssr_exportName__("restoreMenu", () => { try { return restoreMenu } catch {} });
__vite_ssr_exportName__("snapshotMenu", () => { try { return snapshotMenu } catch {} });
__vite_ssr_exportName__("loadSnapshot", () => { try { return loadSnapshot } catch {} });
__vite_ssr_exportName__("getMenuLibrary", () => { try { return getMenuLibrary } catch {} });
__vite_ssr_exportName__("clearCurrentMenu", () => { try { return clearCurrentMenu } catch {} });
__vite_ssr_exportName__("exportAllMenus", () => { try { return exportAllMenus } catch {} });
__vite_ssr_exportName__("importBackup", () => { try { return importBackup } catch {} });
__vite_ssr_exportName__("getStorageUsage", () => { try { return getStorageUsage } catch {} });
__vite_ssr_exportName__("formatStorageSize", () => { try { return formatStorageSize } catch {} });
const STORAGE_KEY_CURRENT = "menu-current";
const STORAGE_KEY_LIBRARY = "menu-library";
const AUTO_SAVE_DEBOUNCE_MS = 500;
let autoSaveTimeout = null;
function createEmptyMenu(weekOf) {
  const defaultWeekOf = weekOf || getStartOfWeek(/* @__PURE__ */ new Date()).toISOString().split("T")[0];
  const emptyMealFoods = {
    breakfast: [],
    lunch: [],
    dinner: []
  };
  return {
    weekOf: defaultWeekOf,
    meals: {
      monday: { ...emptyMealFoods },
      tuesday: { ...emptyMealFoods },
      wednesday: { ...emptyMealFoods },
      thursday: { ...emptyMealFoods },
      friday: { ...emptyMealFoods },
      saturday: { ...emptyMealFoods },
      sunday: { ...emptyMealFoods }
    },
    lastModified: (/* @__PURE__ */ new Date()).toISOString()
  };
};
function autoSaveMenu(menu) {
  if (autoSaveTimeout) {
    clearTimeout(autoSaveTimeout);
  };
  autoSaveTimeout = setTimeout(() => {
    try {
      const updatedMenu = {
        ...menu,
        lastModified: (/* @__PURE__ */ new Date()).toISOString()
      };
      localStorage.setItem(STORAGE_KEY_CURRENT, JSON.stringify(updatedMenu));
      console.log("[MenuStorage] Auto-saved menu");
    } catch (error) {
      console.error("[MenuStorage] Failed to auto-save:", error);
      handleStorageError(error);
    }
  }, AUTO_SAVE_DEBOUNCE_MS);
};
function restoreMenu() {
  try {
    const stored = localStorage.getItem(STORAGE_KEY_CURRENT);
    if (!stored) {
      console.log("[MenuStorage] No saved menu found");
      return null;
    };
    const menu = JSON.parse(stored);
    console.log("[MenuStorage] Restored menu from", menu.weekOf);
    return menu;
  } catch (error) {
    console.error("[MenuStorage] Failed to restore menu:", error);
    return null;
  }
};
function snapshotMenu(menu, name, totalSynergyScore) {
  try {
    const snapshot = {
      ...menu,
      name,
      created: (/* @__PURE__ */ new Date()).toISOString(),
      totalSynergyScore
    };
    const library = getMenuLibrary();
    library.push(snapshot);
    localStorage.setItem(STORAGE_KEY_LIBRARY, JSON.stringify(library));
    console.log("[MenuStorage] Saved snapshot:", name);
  } catch (error) {
    console.error("[MenuStorage] Failed to save snapshot:", error);
    handleStorageError(error);
  }
};
function loadSnapshot(name) {
  try {
    const library = getMenuLibrary();
    const snapshot = library.find((s) => s.name === name);
    if (!snapshot) {
      console.warn("[MenuStorage] Snapshot not found:", name);
      return null;
    };
    const menu = {
      weekOf: snapshot.weekOf,
      meals: snapshot.meals,
      lastModified: (/* @__PURE__ */ new Date()).toISOString()
    };
    autoSaveMenu(menu);
    console.log("[MenuStorage] Loaded snapshot:", name);
    return menu;
  } catch (error) {
    console.error("[MenuStorage] Failed to load snapshot:", error);
    return null;
  }
};
function getMenuLibrary() {
  try {
    const stored = localStorage.getItem(STORAGE_KEY_LIBRARY);
    if (!stored) {
      return [];
    };
    return JSON.parse(stored);
  } catch (error) {
    console.error("[MenuStorage] Failed to load library:", error);
    return [];
  }
};
function clearCurrentMenu() {
  try {
    localStorage.removeItem(STORAGE_KEY_CURRENT);
    console.log("[MenuStorage] Cleared current menu");
  } catch (error) {
    console.error("[MenuStorage] Failed to clear menu:", error);
  }
};
function exportAllMenus() {
  return {
    current: restoreMenu(),
    library: getMenuLibrary()
  };
};
function importBackup(json) {
  try {
    const data = JSON.parse(json);
    if (!data.library || !Array.isArray(data.library)) {
      throw new Error("Invalid backup format: missing library array");
    };
    if (data.library.length > 0) {
      localStorage.setItem(STORAGE_KEY_LIBRARY, JSON.stringify(data.library));
      console.log("[MenuStorage] Imported", data.library.length, "snapshots");
    };
    if (data.current) {
      localStorage.setItem(STORAGE_KEY_CURRENT, JSON.stringify(data.current));
      console.log("[MenuStorage] Imported current menu");
    };
    return true;
  } catch (error) {
    console.error("[MenuStorage] Failed to import backup:", error);
    return false;
  }
};
function getStartOfWeek(date) {
  const day = date.getDay();
  const diff = date.getDate() - day + (day === 0 ? -6 : 1);
  return new Date(date.setDate(diff));
}
function handleStorageError(error) {
  if (error.name === "QuotaExceededError") {
    console.error("[MenuStorage] localStorage quota exceeded!");
    console.error("Consider:");
    console.error("  1. Clearing old snapshots");
    console.error("  2. Exporting a backup and clearing storage");
  }
}
function getStorageUsage() {
  try {
    const currentData = localStorage.getItem(STORAGE_KEY_CURRENT) || "";
    const libraryData = localStorage.getItem(STORAGE_KEY_LIBRARY) || "";
    const currentSize = new Blob([currentData]).size;
    const librarySize = new Blob([libraryData]).size;
    return {
      current: currentSize,
      library: librarySize,
      total: currentSize + librarySize
    };
  } catch (error) {
    console.error("[MenuStorage] Failed to calculate usage:", error);
    return { current: 0, library: 0, total: 0 };
  }
};
function formatStorageSize(bytes) {
  if (bytes < 1024) {
    return `${bytes} B`;
  } else if (bytes < 1024 * 1024) {
    return `${(bytes / 1024).toFixed(2)} KB`;
  } else {
    return `${(bytes / (1024 * 1024)).toFixed(2)} MB`;
  }
}
//# sourceMappingSource=vite-generated
//# sourceMappingURL=data:application/json;base64,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SSxRQUFRLE1BQU07QUFDaEIsV0FBTyxHQUFHLEtBQUs7QUFBQSxFQUNqQixXQUFXLFFBQVEsT0FBTyxNQUFNO0FBQzlCLFdBQU8sSUFBSSxRQUFRLE1BQU0sUUFBUSxDQUFDLENBQUM7QUFBQSxFQUNyQyxPQUFPO0FBQ0wsV0FBTyxJQUFJLFNBQVMsT0FBTyxPQUFPLFFBQVEsQ0FBQyxDQUFDO0FBQUEsRUFDOUM7QUFDRiIsIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsibWVudVN0b3JhZ2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNZW51IFN0b3JhZ2UgLSBsb2NhbFN0b3JhZ2UgT3BlcmF0aW9uc1xuICpcbiAqIEhhbmRsZXMgdHJhbnNwYXJlbnQgbG9jYWxTdG9yYWdlIHBlcnNpc3RlbmNlIGZvciB3ZWVrbHkgbWVudXMuXG4gKiBJbXBsZW1lbnRzIGF1dG8tc2F2ZSwgcmVzdG9yZSwgYW5kIHNuYXBzaG90IGZ1bmN0aW9uYWxpdHkuXG4gKi9cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVHlwZXNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBNZWFsRm9vZHMge1xuICBicmVha2Zhc3Q6IHN0cmluZ1tdOyAgLy8gZm9vZCBJRHNcbiAgbHVuY2g6IHN0cmluZ1tdO1xuICBkaW5uZXI6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFdlZWtseU1lbnUge1xuICB3ZWVrT2Y6IHN0cmluZzsgIC8vIElTTyBkYXRlIChZWVlZLU1NLUREKVxuICBtZWFsczoge1xuICAgIG1vbmRheTogTWVhbEZvb2RzO1xuICAgIHR1ZXNkYXk6IE1lYWxGb29kcztcbiAgICB3ZWRuZXNkYXk6IE1lYWxGb29kcztcbiAgICB0aHVyc2RheTogTWVhbEZvb2RzO1xuICAgIGZyaWRheTogTWVhbEZvb2RzO1xuICAgIHNhdHVyZGF5OiBNZWFsRm9vZHM7XG4gICAgc3VuZGF5OiBNZWFsRm9vZHM7XG4gIH07XG4gIGxhc3RNb2RpZmllZDogc3RyaW5nOyAgLy8gSVNPIHRpbWVzdGFtcFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1lbnVTbmFwc2hvdCBleHRlbmRzIFdlZWtseU1lbnUge1xuICBuYW1lOiBzdHJpbmc7XG4gIGNyZWF0ZWQ6IHN0cmluZztcbiAgdG90YWxTeW5lcmd5U2NvcmU6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdG9yYWdlRGF0YSB7XG4gIGN1cnJlbnQ6IFdlZWtseU1lbnUgfCBudWxsO1xuICBsaWJyYXJ5OiBNZW51U25hcHNob3RbXTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ29uc3RhbnRzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNvbnN0IFNUT1JBR0VfS0VZX0NVUlJFTlQgPSAnbWVudS1jdXJyZW50JztcbmNvbnN0IFNUT1JBR0VfS0VZX0xJQlJBUlkgPSAnbWVudS1saWJyYXJ5JztcbmNvbnN0IEFVVE9fU0FWRV9ERUJPVU5DRV9NUyA9IDUwMDtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQXV0by1zYXZlIFN0YXRlXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmxldCBhdXRvU2F2ZVRpbWVvdXQ6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENvcmUgRnVuY3Rpb25zXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQ3JlYXRlIGFuIGVtcHR5IHdlZWtseSBtZW51XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVFbXB0eU1lbnUod2Vla09mPzogc3RyaW5nKTogV2Vla2x5TWVudSB7XG4gIGNvbnN0IGRlZmF1bHRXZWVrT2YgPSB3ZWVrT2YgfHwgZ2V0U3RhcnRPZldlZWsobmV3IERhdGUoKSkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xuXG4gIGNvbnN0IGVtcHR5TWVhbEZvb2RzOiBNZWFsRm9vZHMgPSB7XG4gICAgYnJlYWtmYXN0OiBbXSxcbiAgICBsdW5jaDogW10sXG4gICAgZGlubmVyOiBbXSxcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHdlZWtPZjogZGVmYXVsdFdlZWtPZixcbiAgICBtZWFsczoge1xuICAgICAgbW9uZGF5OiB7IC4uLmVtcHR5TWVhbEZvb2RzIH0sXG4gICAgICB0dWVzZGF5OiB7IC4uLmVtcHR5TWVhbEZvb2RzIH0sXG4gICAgICB3ZWRuZXNkYXk6IHsgLi4uZW1wdHlNZWFsRm9vZHMgfSxcbiAgICAgIHRodXJzZGF5OiB7IC4uLmVtcHR5TWVhbEZvb2RzIH0sXG4gICAgICBmcmlkYXk6IHsgLi4uZW1wdHlNZWFsRm9vZHMgfSxcbiAgICAgIHNhdHVyZGF5OiB7IC4uLmVtcHR5TWVhbEZvb2RzIH0sXG4gICAgICBzdW5kYXk6IHsgLi4uZW1wdHlNZWFsRm9vZHMgfSxcbiAgICB9LFxuICAgIGxhc3RNb2RpZmllZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICB9O1xufVxuXG4vKipcbiAqIEF1dG8tc2F2ZSBtZW51IHRvIGxvY2FsU3RvcmFnZSAoZGVib3VuY2VkKVxuICpcbiAqIEF1dG9tYXRpY2FsbHkgc2F2ZXMgYWZ0ZXIgNTAwbXMgb2YgaW5hY3Rpdml0eVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXV0b1NhdmVNZW51KG1lbnU6IFdlZWtseU1lbnUpOiB2b2lkIHtcbiAgLy8gQ2xlYXIgZXhpc3RpbmcgdGltZW91dFxuICBpZiAoYXV0b1NhdmVUaW1lb3V0KSB7XG4gICAgY2xlYXJUaW1lb3V0KGF1dG9TYXZlVGltZW91dCk7XG4gIH1cblxuICAvLyBTZXQgbmV3IHRpbWVvdXRcbiAgYXV0b1NhdmVUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVwZGF0ZWRNZW51ID0ge1xuICAgICAgICAuLi5tZW51LFxuICAgICAgICBsYXN0TW9kaWZpZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH07XG5cbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZX0NVUlJFTlQsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWRNZW51KSk7XG4gICAgICBjb25zb2xlLmxvZygnW01lbnVTdG9yYWdlXSBBdXRvLXNhdmVkIG1lbnUnKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW01lbnVTdG9yYWdlXSBGYWlsZWQgdG8gYXV0by1zYXZlOicsIGVycm9yKTtcbiAgICAgIGhhbmRsZVN0b3JhZ2VFcnJvcihlcnJvcik7XG4gICAgfVxuICB9LCBBVVRPX1NBVkVfREVCT1VOQ0VfTVMpO1xufVxuXG4vKipcbiAqIFJlc3RvcmUgbWVudSBmcm9tIGxvY2FsU3RvcmFnZVxuICpcbiAqIFJldHVybnMgbnVsbCBpZiBubyBzYXZlZCBtZW51IGV4aXN0c1xuICovXG5leHBvcnQgZnVuY3Rpb24gcmVzdG9yZU1lbnUoKTogV2Vla2x5TWVudSB8IG51bGwge1xuICB0cnkge1xuICAgIGNvbnN0IHN0b3JlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZX0NVUlJFTlQpO1xuXG4gICAgaWYgKCFzdG9yZWQpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbTWVudVN0b3JhZ2VdIE5vIHNhdmVkIG1lbnUgZm91bmQnKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IG1lbnUgPSBKU09OLnBhcnNlKHN0b3JlZCkgYXMgV2Vla2x5TWVudTtcbiAgICBjb25zb2xlLmxvZygnW01lbnVTdG9yYWdlXSBSZXN0b3JlZCBtZW51IGZyb20nLCBtZW51LndlZWtPZik7XG4gICAgcmV0dXJuIG1lbnU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW01lbnVTdG9yYWdlXSBGYWlsZWQgdG8gcmVzdG9yZSBtZW51OicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIFNuYXBzaG90IGN1cnJlbnQgbWVudSB0byBsaWJyYXJ5XG4gKlxuICogQHBhcmFtIG1lbnUgLSBDdXJyZW50IG1lbnUgdG8gc25hcHNob3RcbiAqIEBwYXJhbSBuYW1lIC0gTmFtZSBmb3IgdGhlIHNuYXBzaG90XG4gKiBAcGFyYW0gdG90YWxTeW5lcmd5U2NvcmUgLSBUb3RhbCBzeW5lcmd5IHNjb3JlIGZvciB0aGUgbWVudVxuICovXG5leHBvcnQgZnVuY3Rpb24gc25hcHNob3RNZW51KFxuICBtZW51OiBXZWVrbHlNZW51LFxuICBuYW1lOiBzdHJpbmcsXG4gIHRvdGFsU3luZXJneVNjb3JlOiBudW1iZXJcbik6IHZvaWQge1xuICB0cnkge1xuICAgIGNvbnN0IHNuYXBzaG90OiBNZW51U25hcHNob3QgPSB7XG4gICAgICAuLi5tZW51LFxuICAgICAgbmFtZSxcbiAgICAgIGNyZWF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHRvdGFsU3luZXJneVNjb3JlLFxuICAgIH07XG5cbiAgICAvLyBHZXQgZXhpc3RpbmcgbGlicmFyeVxuICAgIGNvbnN0IGxpYnJhcnkgPSBnZXRNZW51TGlicmFyeSgpO1xuXG4gICAgLy8gQXBwZW5kIG5ldyBzbmFwc2hvdFxuICAgIGxpYnJhcnkucHVzaChzbmFwc2hvdCk7XG5cbiAgICAvLyBTYXZlIHVwZGF0ZWQgbGlicmFyeVxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZX0xJQlJBUlksIEpTT04uc3RyaW5naWZ5KGxpYnJhcnkpKTtcblxuICAgIGNvbnNvbGUubG9nKCdbTWVudVN0b3JhZ2VdIFNhdmVkIHNuYXBzaG90OicsIG5hbWUpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tNZW51U3RvcmFnZV0gRmFpbGVkIHRvIHNhdmUgc25hcHNob3Q6JywgZXJyb3IpO1xuICAgIGhhbmRsZVN0b3JhZ2VFcnJvcihlcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiBMb2FkIGEgc25hcHNob3QgZnJvbSBsaWJyYXJ5IGludG8gY3VycmVudCBtZW51XG4gKlxuICogQHBhcmFtIG5hbWUgLSBOYW1lIG9mIHRoZSBzbmFwc2hvdCB0byBsb2FkXG4gKiBAcmV0dXJucyBUaGUgbG9hZGVkIG1lbnUsIG9yIG51bGwgaWYgbm90IGZvdW5kXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsb2FkU25hcHNob3QobmFtZTogc3RyaW5nKTogV2Vla2x5TWVudSB8IG51bGwge1xuICB0cnkge1xuICAgIGNvbnN0IGxpYnJhcnkgPSBnZXRNZW51TGlicmFyeSgpO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gbGlicmFyeS5maW5kKHMgPT4gcy5uYW1lID09PSBuYW1lKTtcblxuICAgIGlmICghc25hcHNob3QpIHtcbiAgICAgIGNvbnNvbGUud2FybignW01lbnVTdG9yYWdlXSBTbmFwc2hvdCBub3QgZm91bmQ6JywgbmFtZSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0IHNuYXBzaG90IHRvIG1lbnUgKHJlbW92ZSBzbmFwc2hvdC1zcGVjaWZpYyBmaWVsZHMpXG4gICAgY29uc3QgbWVudTogV2Vla2x5TWVudSA9IHtcbiAgICAgIHdlZWtPZjogc25hcHNob3Qud2Vla09mLFxuICAgICAgbWVhbHM6IHNuYXBzaG90Lm1lYWxzLFxuICAgICAgbGFzdE1vZGlmaWVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcblxuICAgIC8vIEF1dG8tc2F2ZSBhcyBjdXJyZW50IG1lbnVcbiAgICBhdXRvU2F2ZU1lbnUobWVudSk7XG5cbiAgICBjb25zb2xlLmxvZygnW01lbnVTdG9yYWdlXSBMb2FkZWQgc25hcHNob3Q6JywgbmFtZSk7XG4gICAgcmV0dXJuIG1lbnU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW01lbnVTdG9yYWdlXSBGYWlsZWQgdG8gbG9hZCBzbmFwc2hvdDonLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgYWxsIHNuYXBzaG90cyBmcm9tIGxpYnJhcnlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldE1lbnVMaWJyYXJ5KCk6IE1lbnVTbmFwc2hvdFtdIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdG9yZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShTVE9SQUdFX0tFWV9MSUJSQVJZKTtcblxuICAgIGlmICghc3RvcmVkKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgcmV0dXJuIEpTT04ucGFyc2Uoc3RvcmVkKSBhcyBNZW51U25hcHNob3RbXTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbTWVudVN0b3JhZ2VdIEZhaWxlZCB0byBsb2FkIGxpYnJhcnk6JywgZXJyb3IpO1xuICAgIHJldHVybiBbXTtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFyIGN1cnJlbnQgbWVudSAocmVzZXQgdG8gZW1wdHkpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjbGVhckN1cnJlbnRNZW51KCk6IHZvaWQge1xuICB0cnkge1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFNUT1JBR0VfS0VZX0NVUlJFTlQpO1xuICAgIGNvbnNvbGUubG9nKCdbTWVudVN0b3JhZ2VdIENsZWFyZWQgY3VycmVudCBtZW51Jyk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW01lbnVTdG9yYWdlXSBGYWlsZWQgdG8gY2xlYXIgbWVudTonLCBlcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiBFeHBvcnQgYWxsIG1lbnVzIChjdXJyZW50ICsgbGlicmFyeSkgYXMgSlNPTlxuICovXG5leHBvcnQgZnVuY3Rpb24gZXhwb3J0QWxsTWVudXMoKTogU3RvcmFnZURhdGEge1xuICByZXR1cm4ge1xuICAgIGN1cnJlbnQ6IHJlc3RvcmVNZW51KCksXG4gICAgbGlicmFyeTogZ2V0TWVudUxpYnJhcnkoKSxcbiAgfTtcbn1cblxuLyoqXG4gKiBJbXBvcnQgbWVudXMgZnJvbSBiYWNrdXAgSlNPTlxuICpcbiAqIEBwYXJhbSBqc29uIC0gSlNPTiBzdHJpbmcgY29udGFpbmluZyBiYWNrdXAgZGF0YVxuICogQHJldHVybnMgdHJ1ZSBpZiBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGltcG9ydEJhY2t1cChqc29uOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShqc29uKSBhcyBTdG9yYWdlRGF0YTtcblxuICAgIC8vIFZhbGlkYXRlIHN0cnVjdHVyZVxuICAgIGlmICghZGF0YS5saWJyYXJ5IHx8ICFBcnJheS5pc0FycmF5KGRhdGEubGlicmFyeSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBiYWNrdXAgZm9ybWF0OiBtaXNzaW5nIGxpYnJhcnkgYXJyYXknKTtcbiAgICB9XG5cbiAgICAvLyBJbXBvcnQgbGlicmFyeVxuICAgIGlmIChkYXRhLmxpYnJhcnkubGVuZ3RoID4gMCkge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVlfTElCUkFSWSwgSlNPTi5zdHJpbmdpZnkoZGF0YS5saWJyYXJ5KSk7XG4gICAgICBjb25zb2xlLmxvZygnW01lbnVTdG9yYWdlXSBJbXBvcnRlZCcsIGRhdGEubGlicmFyeS5sZW5ndGgsICdzbmFwc2hvdHMnKTtcbiAgICB9XG5cbiAgICAvLyBJbXBvcnQgY3VycmVudCBtZW51IGlmIGV4aXN0c1xuICAgIGlmIChkYXRhLmN1cnJlbnQpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZX0NVUlJFTlQsIEpTT04uc3RyaW5naWZ5KGRhdGEuY3VycmVudCkpO1xuICAgICAgY29uc29sZS5sb2coJ1tNZW51U3RvcmFnZV0gSW1wb3J0ZWQgY3VycmVudCBtZW51Jyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW01lbnVTdG9yYWdlXSBGYWlsZWQgdG8gaW1wb3J0IGJhY2t1cDonLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhlbHBlciBGdW5jdGlvbnNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBHZXQgc3RhcnQgb2Ygd2VlayAoTW9uZGF5KSBmb3IgYSBnaXZlbiBkYXRlXG4gKi9cbmZ1bmN0aW9uIGdldFN0YXJ0T2ZXZWVrKGRhdGU6IERhdGUpOiBEYXRlIHtcbiAgY29uc3QgZGF5ID0gZGF0ZS5nZXREYXkoKTtcbiAgY29uc3QgZGlmZiA9IGRhdGUuZ2V0RGF0ZSgpIC0gZGF5ICsgKGRheSA9PT0gMCA/IC02IDogMSk7IC8vIEFkanVzdCB3aGVuIGRheSBpcyBTdW5kYXlcbiAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuc2V0RGF0ZShkaWZmKSk7XG59XG5cbi8qKlxuICogSGFuZGxlIGxvY2FsU3RvcmFnZSBlcnJvcnMgKGUuZy4sIHF1b3RhIGV4Y2VlZGVkKVxuICovXG5mdW5jdGlvbiBoYW5kbGVTdG9yYWdlRXJyb3IoZXJyb3I6IGFueSk6IHZvaWQge1xuICBpZiAoZXJyb3IubmFtZSA9PT0gJ1F1b3RhRXhjZWVkZWRFcnJvcicpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbTWVudVN0b3JhZ2VdIGxvY2FsU3RvcmFnZSBxdW90YSBleGNlZWRlZCEnKTtcbiAgICBjb25zb2xlLmVycm9yKCdDb25zaWRlcjonKTtcbiAgICBjb25zb2xlLmVycm9yKCcgIDEuIENsZWFyaW5nIG9sZCBzbmFwc2hvdHMnKTtcbiAgICBjb25zb2xlLmVycm9yKCcgIDIuIEV4cG9ydGluZyBhIGJhY2t1cCBhbmQgY2xlYXJpbmcgc3RvcmFnZScpO1xuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFV0aWxpdHkgRnVuY3Rpb25zXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQ2FsY3VsYXRlIHN0b3JhZ2UgdXNhZ2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFN0b3JhZ2VVc2FnZSgpOiB7XG4gIGN1cnJlbnQ6IG51bWJlcjtcbiAgbGlicmFyeTogbnVtYmVyO1xuICB0b3RhbDogbnVtYmVyO1xufSB7XG4gIHRyeSB7XG4gICAgY29uc3QgY3VycmVudERhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShTVE9SQUdFX0tFWV9DVVJSRU5UKSB8fCAnJztcbiAgICBjb25zdCBsaWJyYXJ5RGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZX0xJQlJBUlkpIHx8ICcnO1xuXG4gICAgY29uc3QgY3VycmVudFNpemUgPSBuZXcgQmxvYihbY3VycmVudERhdGFdKS5zaXplO1xuICAgIGNvbnN0IGxpYnJhcnlTaXplID0gbmV3IEJsb2IoW2xpYnJhcnlEYXRhXSkuc2l6ZTtcblxuICAgIHJldHVybiB7XG4gICAgICBjdXJyZW50OiBjdXJyZW50U2l6ZSxcbiAgICAgIGxpYnJhcnk6IGxpYnJhcnlTaXplLFxuICAgICAgdG90YWw6IGN1cnJlbnRTaXplICsgbGlicmFyeVNpemUsXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbTWVudVN0b3JhZ2VdIEZhaWxlZCB0byBjYWxjdWxhdGUgdXNhZ2U6JywgZXJyb3IpO1xuICAgIHJldHVybiB7IGN1cnJlbnQ6IDAsIGxpYnJhcnk6IDAsIHRvdGFsOiAwIH07XG4gIH1cbn1cblxuLyoqXG4gKiBGb3JtYXQgc3RvcmFnZSBzaXplIGZvciBkaXNwbGF5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRTdG9yYWdlU2l6ZShieXRlczogbnVtYmVyKTogc3RyaW5nIHtcbiAgaWYgKGJ5dGVzIDwgMTAyNCkge1xuICAgIHJldHVybiBgJHtieXRlc30gQmA7XG4gIH0gZWxzZSBpZiAoYnl0ZXMgPCAxMDI0ICogMTAyNCkge1xuICAgIHJldHVybiBgJHsoYnl0ZXMgLyAxMDI0KS50b0ZpeGVkKDIpfSBLQmA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGAkeyhieXRlcyAvICgxMDI0ICogMTAyNCkpLnRvRml4ZWQoMil9IE1CYDtcbiAgfVxufVxuIl0sImZpbGUiOiIvc3JjL3V0aWxzL21lbnVTdG9yYWdlLnRzIn0=
